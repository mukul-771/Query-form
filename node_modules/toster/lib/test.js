'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Test = undefined;

var _baseTest = require('./base-test');

var _testStatus = require('./test-status');

var _util = require('./util');

class Test extends _baseTest.BaseTest {
  constructor() {
    let opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    let testFunction = typeof opts.testFunction === 'function' ? opts.testFunction : null;
    if ((!opts.initialStatus || opts.initialStatus === _testStatus.NOT_EXECUTED) && !testFunction) {
      opts.initialStatus = _testStatus.SKIP;
    }
    super(opts);

    this._testFunction = testFunction;
    this._timeout = opts.timeout || 5000;
  }

  testFunction() {
    return this._testFunction;
  }

  _run() {
    let timeout = new Promise(resolve => setTimeout(resolve, this._timeout)).then(() => this._setStatusAsync(new _testStatus.TestTimeoutStatus(this._timeout)));

    let setStatus = (0, _util.runCallback)(this._testFunction, this._state).then(() => this._setStatusAsync(_testStatus.SUCCESS), err => this._setStatusAsync(new _testStatus.TestFailStatus(err)));

    return Promise.race([timeout, setStatus]).then(() => {
      return this._status;
    });
  }
}
exports.Test = Test;